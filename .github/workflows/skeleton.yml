name: Create SFDC Project Skeleton

on: 
  workflow_dispatch: 
    inputs:
      branch_name:
        description: 'Branch name for the SFDC skeleton'
        required:  true
        default:  'sfdc-project'
      project_name: 
        description: 'Salesforce project name'
        required: true
        default: 'my-sfdc-project'
      api_version:
        description:  'Salesforce API version'
        required: true
        default: '59.0'

jobs:
  create-skeleton:
    runs-on: ubuntu-latest
    
    steps:
      # ---------------------------------------------------------
      # 1ï¸âƒ£ Checkout repository
      # ---------------------------------------------------------
      - name:  Checkout code
        uses: actions/checkout@v4
        with: 
          fetch-depth:  0

      # ---------------------------------------------------------
      # 2ï¸âƒ£ Configure Git
      # ---------------------------------------------------------
      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users. noreply.github.com"

      # ---------------------------------------------------------
      # 3ï¸âƒ£ Create new branch
      # ---------------------------------------------------------
      - name: Create new branch
        run: |
          echo "ğŸŒ¿ Creating branch: ${{ github. event.inputs.branch_name }}"
          git checkout -b ${{ github.event.inputs.branch_name }}

      # ---------------------------------------------------------
      # 4ï¸âƒ£ Create SFDC Project Structure
      # ---------------------------------------------------------
      - name:  Create SFDC Skeleton
        run: |
          echo "ğŸ“¦ Creating Salesforce project skeleton..."
          
          PROJECT_NAME="${{ github.event. inputs.project_name }}"
          API_VERSION="${{ github.event.inputs. api_version }}"
          
          # Create directory structure
          mkdir -p force-app/main/default/classes
          mkdir -p force-app/main/default/triggers
          mkdir -p force-app/main/default/lwc
          mkdir -p force-app/main/default/aura
          mkdir -p force-app/main/default/objects
          mkdir -p force-app/main/default/layouts
          mkdir -p force-app/main/default/flows
          mkdir -p force-app/main/default/permissionsets
          mkdir -p force-app/main/default/profiles
          mkdir -p force-app/main/default/staticresources
          mkdir -p force-app/main/default/tabs
          mkdir -p force-app/main/default/pages
          mkdir -p force-app/main/default/components
          mkdir -p force-app/main/default/email
          mkdir -p force-app/main/default/queues
          mkdir -p force-app/main/default/reports
          mkdir -p force-app/main/default/dashboards
          mkdir -p scripts/apex
          mkdir -p config
          mkdir -p . vscode
          
          echo "âœ… Directory structure created"

      # ---------------------------------------------------------
      # 5ï¸âƒ£ Create sfdx-project. json
      # ---------------------------------------------------------
      - name: Create sfdx-project.json
        run: |
          API_VERSION="${{ github.event.inputs. api_version }}"
          PROJECT_NAME="${{ github.event.inputs. project_name }}"
          
          cat > sfdx-project. json << EOF
          {
            "packageDirectories": [
              {
                "path": "force-app",
                "default": true
              }
            ],
            "name": "${PROJECT_NAME}",
            "namespace": "",
            "sfdcLoginUrl": "https://login.salesforce. com",
            "sourceApiVersion": "${API_VERSION}"
          }
          EOF
          
          echo "âœ… sfdx-project.json created"

      # ---------------------------------------------------------
      # 6ï¸âƒ£ Create .forceignore
      # ---------------------------------------------------------
      - name: Create .forceignore
        run: |
          cat > .forceignore << 'EOF'
          # List files or directories below to ignore them when running force:source: push, force:source:pull, and force:source:status
          # More information: https://developer.salesforce.com/docs/atlas. en-us. sfdx_dev.meta/sfdx_dev/sfdx_dev_exclude_source.htm

          package. xml

          # LWC configuration files
          **/jsconfig.json
          **/. eslintrc.json

          # LWC Jest
          **/__tests__/**

          # Profiles (optional - uncomment if not tracking profiles)
          # **/profiles/**

          # Admin Profile
          **/profiles/Admin.profile-meta.xml

          # Standard Objects (optional - uncomment to ignore)
          # **/objects/Account/**
          # **/objects/Contact/**

          # Ignore specific metadata
          **/appMenus/**
          **/objectTranslations/**
          **/connectedApps/**
          EOF
          
          echo "âœ… . forceignore created"

      # ---------------------------------------------------------
      # 7ï¸âƒ£ Create .gitignore
      # ---------------------------------------------------------
      - name:  Create .gitignore for SFDC
        run: |
          cat > .gitignore << 'EOF'
          # Salesforce
          .sf/
          . sfdx/
          . localdevserver/

          # LWC
          **/lwc/**/*. css. map
          **/lwc/**/*.js. map

          # Logs
          *.log
          logs/

          # OS Files
          .DS_Store
          Thumbs.db

          # IDE
          .idea/
          *.sublime-project
          *.sublime-workspace

          # Node
          node_modules/
          package-lock.json

          # Auth files
          authfile. txt
          *.key
          *.crt

          # Deployment
          deployment-result.json
          changed-files.txt
          delta-package/
          EOF
          
          echo "âœ… . gitignore updated"

      # ---------------------------------------------------------
      # 8ï¸âƒ£ Create VS Code settings
      # ---------------------------------------------------------
      - name: Create VS Code settings
        run:  |
          cat > .vscode/settings.json << 'EOF'
          {
            "editor.formatOnSave": true,
            "editor.tabSize": 4,
            "salesforcedx-vscode-apex. java.home": "",
            "search.exclude": {
              "**/node_modules":  true,
              "**/bower_components": true,
              "**/.sfdx": true,
              "**/. sf": true
            },
            "files.associations": {
              "*. cmp": "html",
              "*. page": "html",
              "*.component": "html"
            }
          }
          EOF
          
          cat > .vscode/extensions.json << 'EOF'
          {
            "recommendations":  [
              "salesforce.salesforcedx-vscode",
              "salesforce.salesforcedx-vscode-apex",
              "salesforce.salesforcedx-vscode-apex-debugger",
              "salesforce.salesforcedx-vscode-apex-replay-debugger",
              "salesforce.salesforcedx-vscode-core",
              "salesforce.salesforcedx-vscode-lightning",
              "salesforce.salesforcedx-vscode-lwc",
              "salesforce.salesforcedx-vscode-visualforce",
              "redhat.vscode-xml"
            ]
          }
          EOF
          
          echo "âœ… VS Code settings created"

      # ---------------------------------------------------------
      # 9ï¸âƒ£ Create sample Apex class
      # ---------------------------------------------------------
      - name:  Create sample Apex class
        run: |
          API_VERSION="${{ github.event.inputs. api_version }}"
          
          # Sample Apex Class
          cat > force-app/main/default/classes/HelloWorld.cls << 'EOF'
          /**
           * @description Sample Apex class
           * @author GitHub Actions
           */
          public with sharing class HelloWorld {
              
              /**
               * @description Returns a greeting message
               * @param name The name to greet
               * @return String greeting message
               */
              public static String sayHello(String name) {
                  if (String.isBlank(name)) {
                      return 'Hello, World!';
                  }
                  return 'Hello, ' + name + '!';
              }
          }
          EOF
          
          # Apex Class Metadata
          cat > force-app/main/default/classes/HelloWorld.cls-meta.xml << EOF
          <?xml version="1.0" encoding="UTF-8"?>
          <ApexClass xmlns="http://soap.sforce.com/2006/04/metadata">
              <apiVersion>${API_VERSION}</apiVersion>
              <status>Active</status>
          </ApexClass>
          EOF
          
          # Sample Test Class
          cat > force-app/main/default/classes/HelloWorldTest.cls << 'EOF'
          /**
           * @description Test class for HelloWorld
           */
          @isTest
          private class HelloWorldTest {
              
              @isTest
              static void testSayHelloWithName() {
                  String result = HelloWorld.sayHello('Salesforce');
                  System.assertEquals('Hello, Salesforce!', result, 'Should greet with name');
              }
              
              @isTest
              static void testSayHelloWithoutName() {
                  String result = HelloWorld.sayHello(null);
                  System.assertEquals('Hello, World!', result, 'Should return default greeting');
              }
              
              @isTest
              static void testSayHelloWithBlankName() {
                  String result = HelloWorld.sayHello('');
                  System.assertEquals('Hello, World! ', result, 'Should return default greeting for blank');
              }
          }
          EOF
          
          # Test Class Metadata
          cat > force-app/main/default/classes/HelloWorldTest.cls-meta.xml << EOF
          <?xml version="1.0" encoding="UTF-8"?>
          <ApexClass xmlns="http://soap.sforce.com/2006/04/metadata">
              <apiVersion>${API_VERSION}</apiVersion>
              <status>Active</status>
          </ApexClass>
          EOF
          
          echo "âœ… Sample Apex classes created"

      # ---------------------------------------------------------
      # ğŸ”Ÿ Create sample LWC
      # ---------------------------------------------------------
      - name: Create sample LWC
        run: |
          API_VERSION="${{ github.event. inputs.api_version }}"
          
          mkdir -p force-app/main/default/lwc/helloWorld
          
          # LWC HTML
          cat > force-app/main/default/lwc/helloWorld/helloWorld.html << 'EOF'
          <template>
              <lightning-card title="Hello World" icon-name="custom: custom14">
                  <div class="slds-p-horizontal_small">
                      <lightning-input 
                          label="Enter your name" 
                          value={name} 
                          onchange={handleNameChange}>
                      </lightning-input>
                      <p class="slds-p-top_medium">
                          <strong>{greeting}</strong>
                      </p>
                  </div>
              </lightning-card>
          </template>
          EOF
          
          # LWC JavaScript
          cat > force-app/main/default/lwc/helloWorld/helloWorld.js << 'EOF'
          import { LightningElement, track } from 'lwc';

          export default class HelloWorld extends LightningElement {
              @track name = '';

              get greeting() {
                  return this.name ? `Hello, ${this.name}! ` : 'Hello, World!';
              }

              handleNameChange(event) {
                  this.name = event. target.value;
              }
          }
          EOF
          
          # LWC Metadata
          cat > force-app/main/default/lwc/helloWorld/helloWorld.js-meta.xml << EOF
          <?xml version="1.0" encoding="UTF-8"?>
          <LightningComponentBundle xmlns="http://soap.sforce.com/2006/04/metadata">
              <apiVersion>${API_VERSION}</apiVersion>
              <isExposed>true</isExposed>
              <targets>
                  <target>lightning__AppPage</target>
                  <target>lightning__RecordPage</target>
                  <target>lightning__HomePage</target>
              </targets>
          </LightningComponentBundle>
          EOF
          
          echo "âœ… Sample LWC created"

      # ---------------------------------------------------------
      # 1ï¸âƒ£1ï¸âƒ£ Create README
      # ---------------------------------------------------------
      - name: Create README
        run: |
          PROJECT_NAME="${{ github.event.inputs. project_name }}"
          API_VERSION="${{ github.event.inputs.api_version }}"
          
          cat > README.md << EOF
          # ${PROJECT_NAME}

          Salesforce DX Project - API Version ${API_VERSION}

          ## ğŸ“ Project Structure

          \`\`\`
          ${PROJECT_NAME}/
          â”œâ”€â”€ force-app/
          â”‚   â””â”€â”€ main/
          â”‚       â””â”€â”€ default/
          â”‚           â”œâ”€â”€ classes/          # Apex Classes
          â”‚           â”œâ”€â”€ triggers/         # Apex Triggers
          â”‚           â”œâ”€â”€ lwc/              # Lightning Web Components
          â”‚           â”œâ”€â”€ aura/             # Aura Components
          â”‚           â”œâ”€â”€ objects/          # Custom Objects & Fields
          â”‚           â”œâ”€â”€ layouts/          # Page Layouts
          â”‚           â”œâ”€â”€ flows/            # Flows
          â”‚           â”œâ”€â”€ permissionsets/   # Permission Sets
          â”‚           â”œâ”€â”€ profiles/         # Profiles
          â”‚           â”œâ”€â”€ staticresources/  # Static Resources
          â”‚           â”œâ”€â”€ tabs/             # Custom Tabs
          â”‚           â”œâ”€â”€ pages/            # Visualforce Pages
          â”‚           â””â”€â”€ components/       # Visualforce Components
          â”œâ”€â”€ scripts/
          â”‚   â””â”€â”€ apex/                     # Anonymous Apex scripts
          â”œâ”€â”€ config/                       # Configuration files
          â”œâ”€â”€ . vscode/                      # VS Code settings
          â”œâ”€â”€ sfdx-project. json            # SFDX Project configuration
          â”œâ”€â”€ .forceignore                 # Files to ignore in SF operations
          â””â”€â”€ . gitignore                   # Git ignore file
          \`\`\`

          ## ğŸš€ Getting Started

          ### Prerequisites
          - [Salesforce CLI](https://developer.salesforce.com/tools/sfdxcli)
          - [VS Code](https://code.visualstudio. com/) with [Salesforce Extensions](https://marketplace.visualstudio.com/items?itemName=salesforce.salesforcedx-vscode)

          ### Setup

          1. **Clone the repository**
             \`\`\`bash
             git clone <repository-url>
             cd ${PROJECT_NAME}
             \`\`\`

          2. **Authorize your Salesforce org**
             \`\`\`bash
             sf org login web --alias myorg --set-default
             \`\`\`

          3. **Deploy to your org**
             \`\`\`bash
             sf project deploy start --source-dir force-app --target-org myorg
             \`\`\`

          4. **Retrieve from your org**
             \`\`\`bash
             sf project retrieve start --source-dir force-app --target-org myorg
             \`\`\`

          ## ğŸ§ª Running Tests

          \`\`\`bash
          sf apex run test --target-org myorg --test-level RunLocalTests --code-coverage
          \`\`\`

          ## ğŸ“ Useful Commands

          | Command | Description |
          |---------|-------------|
          | \`sf org login web\` | Authorize an org |
          | \`sf project deploy start\` | Deploy source to org |
          | \`sf project retrieve start\` | Retrieve source from org |
          | \`sf apex run test\` | Run Apex tests |
          | \`sf org list\` | List authorized orgs |

          ## ğŸ“„ License

          This project is licensed under the MIT License. 
          EOF
          
          echo "âœ… README. md created"

      # ---------------------------------------------------------
      # 1ï¸âƒ£2ï¸âƒ£ Create placeholder files
      # ---------------------------------------------------------
      - name: Create placeholder files
        run: |
          # Create . gitkeep files to preserve empty directories
          touch force-app/main/default/triggers/. gitkeep
          touch force-app/main/default/aura/.gitkeep
          touch force-app/main/default/objects/.gitkeep
          touch force-app/main/default/layouts/.gitkeep
          touch force-app/main/default/flows/. gitkeep
          touch force-app/main/default/permissionsets/.gitkeep
          touch force-app/main/default/profiles/.gitkeep
          touch force-app/main/default/staticresources/.gitkeep
          touch force-app/main/default/tabs/.gitkeep
          touch force-app/main/default/pages/.gitkeep
          touch force-app/main/default/components/. gitkeep
          touch force-app/main/default/email/.gitkeep
          touch force-app/main/default/queues/.gitkeep
          touch force-app/main/default/reports/.gitkeep
          touch force-app/main/default/dashboards/.gitkeep
          touch scripts/apex/.gitkeep
          touch config/. gitkeep
          
          echo "âœ… Placeholder files created"

      # ---------------------------------------------------------
      # 1ï¸âƒ£3ï¸âƒ£ Commit and Push
      # ---------------------------------------------------------
      - name:  Commit and Push
        run: |
          git add . 
          git commit -m "ğŸ‰ Initialize Salesforce DX project skeleton

          - Created SFDX project structure
          - Added sfdx-project. json (API v${{ github.event. inputs.api_version }})
          - Added .forceignore and .gitignore
          - Added VS Code settings and extensions
          - Added sample Apex class (HelloWorld) with tests
          - Added sample LWC component (helloWorld)
          - Added project README

          Generated by GitHub Actions"
          
          git push origin ${{ github.event. inputs.branch_name }}
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… SFDC Skeleton Created Successfully!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸŒ¿ Branch: ${{ github. event.inputs.branch_name }}"
          echo "ğŸ“¦ Project: ${{ github. event.inputs.project_name }}"
          echo "ğŸ”¢ API Version: ${{ github.event. inputs.api_version }}"
          echo ""
          echo "ğŸ“‚ Structure created:"
          echo "   â”œâ”€â”€ force-app/main/default/"
          echo "   â”‚   â”œâ”€â”€ classes/ (with HelloWorld sample)"
          echo "   â”‚   â”œâ”€â”€ lwc/ (with helloWorld sample)"
          echo "   â”‚   â”œâ”€â”€ triggers/"
          echo "   â”‚   â”œâ”€â”€ aura/"
          echo "   â”‚   â”œâ”€â”€ objects/"
          echo "   â”‚   â”œâ”€â”€ layouts/"
          echo "   â”‚   â”œâ”€â”€ flows/"
          echo "   â”‚   â”œâ”€â”€ permissionsets/"
          echo "   â”‚   â””â”€â”€ ...  more"
          echo "   â”œâ”€â”€ sfdx-project. json"
          echo "   â”œâ”€â”€ .forceignore"
          echo "   â”œâ”€â”€ .gitignore"
          echo "   â””â”€â”€ README.md"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
