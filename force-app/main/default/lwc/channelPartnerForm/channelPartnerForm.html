<template>
    <div class="form-container">
        <lightning-card>
            <div slot="title">
                <div class="header-content">
                    <lightning-icon icon-name="standard:account" size="small" class="header-icon"></lightning-icon>
                    <h1 class="slds-text-heading_medium">Channel Partner Registration</h1>
                </div>
            </div>

            <div class="slds-p-horizontal_large slds-p-vertical_medium">
                <p class="slds-text-body_regular slds-text-color_weak slds-m-bottom_large">
                    Fill the form and click Save. After the record is created, upload documents.
                </p>

                <!-- Banner Alert -->
                <template if:true={showAlert}>
                    <div class={alertClass} role="alert">
                        <lightning-icon icon-name={alertIcon} size="small" variant="inverse" class="slds-m-right_small"></lightning-icon>
                        <h2>{alertMessage}</h2>
                        <button class="slds-button slds-button_icon slds-notify__close" title="Close" onclick={closeAlert}>
                            <lightning-icon icon-name="utility:close" size="x-small" variant="inverse"></lightning-icon>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </template>

                <!-- FORM -->
                <template if:true={showForm}>
                    <div class="form-wrapper">
                        <!-- Section 1: Company Information -->
                        <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                            <h2 class="slds-text-heading_small slds-m-bottom_small section-header">
                                <lightning-icon icon-name="utility:company" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                Company Information
                            </h2>

                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="Company Name" 
                                        name="Company_Name__c" 
                                        value={formData.Company_Name__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="Company Head Name" 
                                        name="Company_Head_Name__c"
                                        value={formData.Company_Head_Name__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="Company Owner Name" 
                                        name="Company_Owner_Name__c"
                                        value={formData.Company_Owner_Name__c}
                                        onchange={handleInputChange}>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        type="number" 
                                        label="Team Strength" 
                                        name="Team_Strength__c"
                                        value={formData.Team_Strength__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        type="url" 
                                        label="Company Website" 
                                        name="Company_Website__c"
                                        value={formData.Company_Website__c}
                                        >
                                    </lightning-input>
                                </div>
                            </div>
                        </div>

                        <!-- Section 2: Contact Information -->
                        <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                            <h2 class="slds-text-heading_small slds-m-bottom_small section-header">
                                <lightning-icon icon-name="utility:email" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                Contact Information
                            </h2>

                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        type="email" 
                                        label="Email" 
                                        name="Email__c"
                                        value={formData.Email__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        type="email" 
                                        label="Company Head Email" 
                                        name="Company_Head_Email_ID__c"
                                        value={formData.Company_Head_Email_ID__c}
                                        onchange={handleInputChange}>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        type="email" 
                                        label="Company Owner Email" 
                                        name="Company_Owner_Email_ID__c"
                                        value={formData.Company_Owner_Email_ID__c}
                                        onchange={handleInputChange}>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        type="tel" 
                                        label="Company Head Contact No" 
                                        name="Company_Head_Contact_No__c"
                                        value={formData.Company_Head_Contact_No__c}
                                        onchange={handleInputChange}
                                        pattern="[0-9]{10}"
                                        message-when-pattern-mismatch="Please enter a valid 10-digit phone number">
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        type="tel" 
                                        label="Company Owner Contact No" 
                                        name="Company_Owner_Contact_No__c"
                                        value={formData.Company_Owner_Contact_No__c}
                                        onchange={handleInputChange}
                                        pattern="[0-9]{10}"
                                        message-when-pattern-mismatch="Please enter a valid 10-digit phone number">
                                    </lightning-input>
                                </div>
                            </div>
                        </div>

                        <!-- Section 3: Location Details -->
                        <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                            <h2 class="slds-text-heading_small slds-m-bottom_small section-header">
                                <lightning-icon icon-name="utility:location" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                Location Details
                            </h2>

                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-textarea 
                                        label="Company Address" 
                                        name="Company_Address__c"
                                        value={formData.Company_Address__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-textarea>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="City" 
                                        name="City__c"
                                        value={formData.City__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="City You Reside In" 
                                        name="City_you_reside_in__c"
                                        value={formData.City_you_reside_in__c}
                                        onchange={handleInputChange}>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="Select Region" 
                                        name="Select_Region__c"
                                        value={formData.Select_Region__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-input>
                                </div>
                            </div>
                        </div>

                        <!-- Section 4: Tax & Registration Details -->
                        <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                            <h2 class="slds-text-heading_small slds-m-bottom_small section-header">
                                <lightning-icon icon-name="utility:file" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                Tax & Registration Details
                            </h2>

                            <div class="slds-grid slds-wrap slds-gutters">
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="Company GST No" 
                                        name="Company_GST_No__c"
                                        value={formData.Company_GST_No__c}
                                        onchange={handleInputChange}
                                        required
                                        max-length="15"
                                        pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}"
                                        message-when-pattern-mismatch="Please enter a valid GST number">
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="Company PAN Card No" 
                                        name="Company_PAN_Card_No__c"
                                        value={formData.Company_PAN_Card_No__c}
                                        onchange={handleInputChange}
                                        required
                                        max-length="10"
                                        pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}"
                                        message-when-pattern-mismatch="Please enter a valid PAN (e.g., ABCDE1234F)">
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="PAN Card No" 
                                        name="PAN_Card_No__c"
                                        value={formData.PAN_Card_No__c}
                                        onchange={handleInputChange}
                                        required
                                        max-length="10"
                                        pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}"
                                        message-when-pattern-mismatch="Please enter a valid PAN (e.g., ABCDE1234F)">
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        label="Company RERA No" 
                                        name="Company_RERA_No__c"
                                        value={formData.Company_RERA_No__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-input>
                                </div>

                                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                                    <lightning-input 
                                        type="date" 
                                        label="RERA Validity" 
                                        name="RERA_Validity__c"
                                        value={formData.RERA_Validity__c}
                                        onchange={handleInputChange}
                                        required>
                                    </lightning-input>
                                </div>
                            </div>
                        </div>

                        <div class="slds-text-align_center slds-m-top_large slds-m-bottom_medium">
                            <lightning-button
                                label={saveButtonLabel}
                                variant="brand"
                                icon-name="utility:check"
                                class="submit-button"
                                disabled={isSaving}
                                onclick={handleSave}>
                            </lightning-button>
                        </div>
                    </div>
                </template>

                <!-- UPLOAD SECTION -->
                <div class="slds-box slds-theme_shade slds-m-top_medium">
                    <h2 class="slds-text-heading_small slds-m-bottom_small section-header">
                        <lightning-icon icon-name="utility:attach" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                        Document Upload
                    </h2>

                    <template if:false={recordId}>
                        <div class="info-box">
                            <lightning-icon icon-name="utility:info" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                            <span class="slds-text-body_small">
                                Save the application first. After the record is created, you can upload documents.
                            </span>
                        </div>
                    </template>

                    <template if:true={recordId}>
                        <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_medium">
                            Upload documents. They will be attached to Reference ID: <strong>{recordId}</strong>
                        </p>

                        <div class="slds-grid slds-wrap slds-gutters">
                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="upload-section">
                                    <label class="slds-form-element__label upload-label">
                                        <lightning-icon icon-name="doctype:pdf" size="x-small" class="slds-m-right_xx-small"></lightning-icon>
                                        GST Certificate
                                    </label>
                                    <input 
                                        type="file" 
                                        accept=".pdf,.jpg,.jpeg,.png" 
                                        data-document-type="GST Certificate"
                                        onchange={handleFileUpload} 
                                        class="file-input" />
                                    <template if:true={uploadStatus.gst}>
                                        <div class="upload-success">
                                            <lightning-icon icon-name="utility:success" size="xx-small" class="success-icon"></lightning-icon>
                                            <span>{uploadStatus.gst}</span>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="upload-section">
                                    <label class="slds-form-element__label upload-label">
                                        <lightning-icon icon-name="doctype:pdf" size="x-small" class="slds-m-right_xx-small"></lightning-icon>
                                        PAN Card
                                    </label>
                                    <input 
                                        type="file" 
                                        accept=".pdf,.jpg,.jpeg,.png" 
                                        data-document-type="PAN Card"
                                        onchange={handleFileUpload} 
                                        class="file-input" />
                                    <template if:true={uploadStatus.pan}>
                                        <div class="upload-success">
                                            <lightning-icon icon-name="utility:success" size="xx-small" class="success-icon"></lightning-icon>
                                            <span>{uploadStatus.pan}</span>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="upload-section">
                                    <label class="slds-form-element__label upload-label">
                                        <lightning-icon icon-name="doctype:pdf" size="x-small" class="slds-m-right_xx-small"></lightning-icon>
                                        RERA Certificate
                                    </label>
                                    <input 
                                        type="file" 
                                        accept=".pdf,.jpg,.jpeg,.png" 
                                        data-document-type="RERA Certificate"
                                        onchange={handleFileUpload} 
                                        class="file-input" />
                                    <template if:true={uploadStatus.rera}>
                                        <div class="upload-success">
                                            <lightning-icon icon-name="utility:success" size="xx-small" class="success-icon"></lightning-icon>
                                            <span>{uploadStatus.rera}</span>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
                                <div class="upload-section">
                                    <label class="slds-form-element__label upload-label">
                                        <lightning-icon icon-name="doctype:pdf" size="x-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Aadhar Card
                                    </label>
                                    <input 
                                        type="file" 
                                        accept=".pdf,.jpg,.jpeg,.png" 
                                        data-document-type="Aadhar Card"
                                        onchange={handleFileUpload} 
                                        class="file-input" />
                                    <template if:true={uploadStatus.aadhar}>
                                        <div class="upload-success">
                                            <lightning-icon icon-name="utility:success" size="xx-small" class="success-icon"></lightning-icon>
                                            <span>{uploadStatus.aadhar}</span>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <div class="slds-col slds-size_1-of-1">
                                <div class="upload-section">
                                    <label class="slds-form-element__label upload-label">
                                        <lightning-icon icon-name="doctype:attachment" size="x-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Other Documents (Optional)
                                    </label>
                                    <input 
                                        type="file" 
                                        accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" 
                                        data-document-type="Other Document"
                                        onchange={handleFileUpload} 
                                        multiple 
                                        class="file-input" />
                                    <template if:true={uploadStatus.other}>
                                        <div class="upload-success">
                                            <lightning-icon icon-name="utility:success" size="xx-small" class="success-icon"></lightning-icon>
                                            <span>{uploadStatus.other}</span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <div class="slds-text-align_center slds-m-top_medium">
                            <lightning-button 
                                label="Save Files" 
                                variant="neutral" 
                                icon-name="utility:check"
                                onclick={resetAll}>
                            </lightning-button>
                        </div>
                    </template>
                </div>

            </div>
        </lightning-card>
    </div>
</template>